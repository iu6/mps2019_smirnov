/* Includes ------------------------------------------------------------------*/
//#include "MDR32F9Qx_board.h"
#include "MDR32F9Qx_config.h"
#include "MDR32Fx.h"
#include "MDR32F9Qx_timer.h"
#include "MDR32F9Qx_rst_clk.h"
#include "MDR32F9Qx_bkp.h"
#include "MDR32F9Qx_port.h"
#include "lcd.h"
#include "mlt_lcd.h"
#include "time.h"
#include "common.h"
#include <MDR32F9Qx_adc.h>

  // ??????????? ??????? ???????? 
  #define DELAY(T) for (i = T; i > 0; i--) 
  
  // ??????????? ????????????? ????????? 
  #define KALIBR 1247 
  
  // ?????????? ?????????? 
  int i; 
  float U; 
  uint32_t RESULT;
  char stroka[17]; // ?????? ??????? ??? ??????

// ????????? ????? ????????? ??? 
void ADCInit() { 
	// ????????? ???????????? ??? 
	RST_CLK_PCLKcmd(RST_CLK_PCLK_ADC, ENABLE);
	 // ?????????? ???????? ??? ????? ????????? ??? 
	 ADC_InitTypeDef ADC; 
	 // ???????? ???????? ?? ????????? ? ????????? 
	 ADC_StructInit(&ADC); 
	 // ????????????? ??? ??????????? ?????????? 
	 ADC_Init(&ADC); 
	 } 

	 // ????????? ????????? ???1 
void ADC1Init() { 
	// ?????????? ???????? ??? ????? ????????? ???1 
	ADCx_InitTypeDef ADC1;
	 // ???????? ???????? ?? ????????? ? ????????? 
	 ADCx_StructInit(&ADC1); 
	 // ????????? ?????? ?????? ???, 
	 // ????????????? ? ????????? R1 ?????
	  ADC1.ADC_ChannelNumber = ADC_CH_ADC7; 
	  // ????????????? ??????? ??? ??????????? ?????????? 
	  ADC1_Init(&ADC1); 
	  // ????????? ??????? ??? 
	  ADC1_Cmd(ENABLE);
 } 
	  
	  // ?????????? ??????? ???????
	   int main () {
			 U_MLT_Init();
			
			 ADCInit(); // ????? ??????? ????? ????????? ??? 
			 ADC1Init(); 
			 // ????? ??????? ?????????????? ????????? ???1 
			 //LCD_Init(); 
			 // ????? ??????? ????????????? ??-?????? 
			 // ??????? ????
			 while (1) { 
				 ADC1_Start(); 
				 // ?????? ?????????????? // ???????? ????? ?????????? ?????????????? 
				 while (ADC1_GetFlagStatus(ADC1_FLAG_END_OF_CONVERSION) == 0); 
				 // ?????? ?????????? ?????????????? 
				 RESULT = ADC1_GetResult() & 0x00000FFF; 
				 // ?????????? ?????????? ?????????????? 
				 U = (float)RESULT / KALIBR; 
				 // ????? ?????????? ?? ?????
					sprintf(stroka , "U = %5.3fV", U);
					U_MLT_Put_String ("test", 3);
				 
				 // ???????? ??????????? ?? ??????
				DELAY(0xFFFF);
			 }
	   }
		 